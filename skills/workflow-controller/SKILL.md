---
name: workflow-controller
description: Generic multi-turn automation engine. Monitors progress flags and serves prompt fragments from a specified scenario. Use when user asks to "run integration test", "automate the workflow", "start heartbeat monitoring", or "execute a scenario".
---

# Workflow Controller (The Heartbeat)

> **Mantra**: "Precision is the rhythm of success. Logic is constant; Data is variable."

## Instructions

### 1. Ready-Check & Status (MANDATORY)
1.  **Requirement**: Identify the target **Scenario Directory** (e.g., `tests/integration/scenarios/web-calculator/`).
2.  **Execute**: Run `python3 scripts/heartbeat.py --scenario [PATH]`.
3.  **Observation**: The engine automatically maps fragments in `[PATH]/fragments/` to lifecycle stages.

### 2. Operational Modes

#### Mode A: Interactive Polling (The Watcher)
- **Directives**: Use `python3 scripts/heartbeat.py --scenario [PATH] --watch` to monitor progress.
- **Trigger**: Blocks until a new `S{X}_DONE` flag appears in `.agent/workstreams/flags/`.

#### Mode B: Fragment Handoff (The Pointer)
- **Wait**: Monitor `[PATH]/next-prompt.md` (generated by the engine).
- **Action**: Paste the fragment to advance the development conversation.

### 3. Identity Banner
> **Rule (MANDATORY)**: EVERY response MUST start with:
```markdown
> **Heartbeat Status**: Stage [X/N] | Scenario: [Name]
> **Persona**: ğŸ’“ Controller (Observer)
> **Mandate**: Polling Step [$X]
```

## References
- **Engine Script**: [heartbeat.py](scripts/heartbeat.py)
